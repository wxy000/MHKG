<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>实体搜索</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" href="../../../static/layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="../../../static/layuiadmin/style/admin.css" media="all">
    <link rel="stylesheet" href="../../../static/layuiadmin/style/template.css" media="all">
</head>
<body>
<div class="layui-fluid">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md12">
            <div class="layui-card layadmin-serach-main">
                <div id="searchHeader" class="layui-card-header">
                    <!--<button id="backBtn" class="layui-btn layui-btn-radius">返回上一级</button>-->
                    <!--<div class="layui-inline" style="width: 40%;">-->
                        <!--<input type="text" id="keywords" required lay-verify="required" placeholder="请输入实体" autocomplete="off" class="layui-input">-->
                    <!--</div>-->
                    <!--<button id="searchBtn" class="layui-btn layui-btn-normal">搜索</button>-->
                </div>
                <div class="layui-card-body">

                    <ul id="entityList" class="layadmin-serach-list layui-text">
                        <!--{% for node in nodes %}-->
                        <!--<li>-->
                            <!--{% if node.img != '' %}-->
                            <!--<a href="javascript:void(0)" class="layui-serachlist-cover">-->
                                <!--<img src="{{ node.img }}" onerror="this.src='../../../static/src/style/default.jpg';this.onerror=null">-->
                            <!--</a>-->
                            <!--{% endif %}-->
                            <!--<div class="layui-serachlist-text">-->
                                <!--<h3><a href="javascript:void(0)">{{ node.title }}</a></h3>-->
                                <!--<p>{{ node.des }}</p>-->
                            <!--</div>-->
                        <!--</li>-->
                        <!--{% empty %}-->
                        <!--<div style="text-align: center; color: #8D8D8D">暂未收录该实体</div>-->
                        <!--{% endfor %}-->
                    </ul>
                    <div id="LAY-template-search-page" style="text-align: center;">
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>
<div id="xxx" hidden>
    {% for node in nodes %}
    <li>
        {% if node.img != '' %}
        <a href="{{ node.url }}" class="layui-serachlist-cover">
            <img src="{{ node.img }}" onerror="this.src='../../../static/layuiadmin/style/default.jpg';this.onerror=null">
        </a>
        {% endif %}
        <div class="layui-serachlist-text">
            <h3><a href="{{ node.url }}">{{ node.title }}</a></h3>
            <p>{{ node.des }}</p>
        </div>
    </li><hr>{% if not forloop.last %}###{% endif %}
    {% empty %}
    <div style="text-align: center; color: #8D8D8D">暂未收录该实体</div>{% if not forloop.last %}###{% endif %}
    {% endfor %}
</div>

<script src="../../../static/layuiadmin/layui/layui.js"></script>
<script>
    layui.config({
        base: '../../../../static/layuiadmin/' //静态资源所在路径
    }).extend({
        index: 'lib/index' //主入口模块
    }).use(['index', 'laypage', 'util'], function () {
        var laypage = layui.laypage;
        var $ = layui.$;
        var util = layui.util;

        // 回到顶部
        util.fixbar({
            // bar1: true
            // ,click: function(type){
            //     console.log(type);
            //     if(type === 'bar1'){
            //         alert('点击了bar1')
            //     }
            // }
        });

        var xxx = $("#xxx").html();
        xxx = xxx.replace(/&lt;/g, '<');
        xxx = xxx.replace(/&gt;/g, '>');
        // console.log(xxx);
        var data = xxx.split("###");
        // console.log(data);
        var len = data.length;
        if (len === 2) {
            if (data[0].indexOf("暂未收录该实体") !== -1){
                len = 0;
            }
        }
        laypage.render({
            elem: 'LAY-template-search-page'
            , count: len
            , limit: 5
            , jump: function (obj, first) {
                document.getElementById('entityList').innerHTML = function(){
                    var arr = [],
                    thisData = data.concat().splice(obj.curr*obj.limit - obj.limit, obj.limit);
                    layui.each(thisData, function(index, item){
                        arr.push(item);
                    });
                    return arr.join('');
                }();
            }
        });
        $(document).on('click','#searchBtn',function(){
            var s = document.getElementById("keywords").value;
            window.location.href = "?flag=1&keywords=" + s;
        });
        $(document).on('click', '#backBtn', function(){
            window.history.go(-1);
        });

        function getQueryString(name){
            var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
            var r = window.location.search.substr(1).match(reg);
            if(r!=null){
                return decodeURIComponent(r[2]);
            }
            return null;
        }

        //隐藏按钮
        if (getQueryString('flag') === '1'){
            var tihuan1 = "<button id=\"backBtn\" class=\"layui-btn layui-btn-radius\">返回上一级</button>\n" +
                "<div class=\"layui-inline\" style=\"width: 40%;\">\n" +
                "<input type=\"text\" id=\"keywords\" required lay-verify=\"required\" placeholder=\"请输入实体\" autocomplete=\"off\" class=\"layui-input\">\n" +
                "</div>\n" +
                "<button id=\"searchBtn\" class=\"layui-btn layui-btn-normal\">搜索</button>";
            $("#searchHeader").html(tihuan1);
            //将关键词填回搜索框
            $("#keywords").val(getQueryString('keywords'));
        }
        if (getQueryString('flag') === '0'){
            var tihuan2 = "<p style=\"font-size: 18px;\">\n" +
                "<span id='flagTitle' style=\"color: red\"></span> 查询到\n" +
                "<strong id='flagNum'></strong> 个结果\n" +
                "</p>\n" +
                "<p class=\"layadmin-font-em\">耗时：350ms</p>";
            // $("#searchHeader").attr("style","display:none;");
            $("#searchHeader").html(tihuan2);
            $("#flagTitle").text(getQueryString('keywords'));
            $("#flagNum").text(len);
        }

    });
</script>
</body>
</html>