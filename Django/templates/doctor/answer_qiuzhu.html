<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>回复求助</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" href="../../static/layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="../../static/layuiadmin/style/admin.css" media="all">
    <link rel="stylesheet" href="../../static/layuiadmin/style/template.css" media="all">
</head>
<body>
<div class="layadmin-message-fluid">
    <div class="layui-row">
        <div class="layui-col-md12">
            <div class="layui-bg-gray" style="padding: 20px;">
                <span style="font-weight: bold; font-size: 16px;">{{ result.qiuzhuTitle }}</span>
            </div>
        </div>
        <div class="layui-col-md12">
            <form class="layui-form" style="margin-top: -50px;">
                <div class="layui-form-item layui-form-text">
                    <input name="qiuzhuId" required lay-verify="required" value="{{ result.qiuzhuId }}" hidden>
                    <input name="doctorId" required lay-verify="required" value="{{ result.doctorId }}" hidden>
                    <div class="layui-input-block">
                        <textarea id="desc" name="desc" required lay-verify="required" placeholder="请输入您的回答" class="layui-textarea"></textarea>
                    </div>
                </div>

                <div class="layui-form-item" style="overflow: hidden;">
                    <div class="layui-input-block layui-input-right">
                        <button class="layui-btn" lay-submit lay-filter="formDemo">发表</button>
                    </div>
                    <div class="layadmin-messag-icon">
                        <a href="javascript:;"><i class="layui-icon layui-icon-face-smile-b"></i></a>
                        <a href="javascript:;"><i class="layui-icon layui-icon-picture"></i></a>
                        <a href="javascript:;"><i class="layui-icon layui-icon-link"></i></a>
                    </div>
                </div>
            </form>
        </div>
        <div class="layui-col-md12 layadmin-homepage-list-imgtxt message-content">
            {% for allaq in result.allAnswerQiuzhu reversed %}
            <div class="media-body">
                <a href="javascript:;" class="media-left" style="float: left;">
                    <img src="{{ allaq.doctorheader }}" height="46px" width="46px">
                </a>
                <div class="pad-btm">
                    <p class="fontColor"><a href="javascript:;">{{ allaq.doctorname }}</a></p>
                    <p class="min-font">
                        <span class="layui-breadcrumb" lay-separator="-">
                            <a>于</a>
                            <a>{{ allaq.createTime }}</a>
                            <a>解答</a>
                        </span>
                    </p>
                </div>
                <p class="message-text">{{ allaq.content }}</p>
            </div>
            {% empty %}
            <center>暂无回答</center>
            {% endfor %}
        </div>
    </div>
</div>
{% csrf_token %}
<div id="code" hidden>{{ result.code }}</div>
<div id="msg" hidden>{{ result.msg }}</div>
<script src="../../static/layuiadmin/layui/layui.js"></script>
<script>
    layui.config({
        base: '../../../static/layuiadmin/' //静态资源所在路径
    }).extend({
        index: 'lib/index' //主入口模块
    }).use(['index', 'form'], function () {
        var $ = layui.$;
        var form = layui.form;

        form.on('submit(formDemo)', function(data){
            // layer.msg(JSON.stringify(data.field));
            var csrfToken = $("[name='csrfmiddlewaretoken']").val();
            var index = layer.load(2);
            $.ajax({
                headers: {"X-CSRFToken": csrfToken},
                url: '/doctor/inquiry/setAnswerQiuzhu/',
                data: data.field,
                type: 'post',
                success: function (data) {
                    if (data.code === 0) {
                        layer.msg(data.msg, function () {
                            $("#desc").val('');
                            window.location.reload();
                        });
                    } else {
                        layer.msg(data.msg);
                    }
                    layer.close(index);
                },
                error: function (data) {
                    layer.close(index);
                    layer.msg("暂时无法回复求助，请稍后再试");
                }
            });
            return false;
        });

        if ($("#code").text() === '500') {
            var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
            parent.layer.close(index); //再执行关闭
            parent.layer.msg($("#msg").text());
        }
    });
</script>
</body>
</html>